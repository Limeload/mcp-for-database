name: Pull Request Validation

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: PR Validation
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Validate PR title
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          echo "PR Title: $PR_TITLE"
          
          # Check if title follows conventional commits
          if [[ $PR_TITLE =~ ^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+ ]]; then
            echo "✅ PR title follows conventional commits format"
          else
            echo "⚠️ PR title should follow conventional commits format"
            echo "Examples: feat: add new feature, fix: resolve bug, docs: update readme"
          fi
          
      - name: Check PR description
        run: |
          PR_BODY="${{ github.event.pull_request.body }}"
          if [ -z "$PR_BODY" ]; then
            echo "⚠️ PR description is empty - please add a description"
          else
            echo "✅ PR has description"
          fi
          
      - name: Check for breaking changes
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          if [[ $PR_TITLE =~ BREAKING CHANGE|! ]]; then
            echo "⚠️ Breaking change detected - ensure PR description explains the changes"
          else
            echo "✅ No breaking changes detected"
          fi
          
      - name: PR Validation Summary
        run: |
          echo "## Pull Request Validation Results" >> $GITHUB_STEP_SUMMARY
          echo "📋 **PR Details:**" >> $GITHUB_STEP_SUMMARY
          echo "- Title: ${{ github.event.pull_request.title }}" >> $GITHUB_STEP_SUMMARY
          echo "- Author: ${{ github.event.pull_request.user.login }}" >> $GITHUB_STEP_SUMMARY
          echo "- Files changed: ${{ github.event.pull_request.changed_files }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ **Validation completed** - PR is ready for review!" >> $GITHUB_STEP_SUMMARY
